<div class="container">
  <div class="d-flex justify-content-between p-2">
    <h3 class="titre">
      <i class="fa fa-arrow-circle-left me-2 action" (click)="onBack()"></i
      >Infos avance
    </h3>
  </div>
  <hr />
  <form [formGroup]="request" (ngSubmit)="submitForm()">
    <div class="row">
      <div class="col-md-3">
        @if(membre$ | async; as membre) {
        <app-membre-card
          [membre]="infosPret"
          [showActions]="false"
          [showInfosMembre]="false"
        />
        }
      </div>

      <div class="col-md-9">
        <div class="card shadow">
          <div class="card-body">
            <div class="row">
              @if(agences$ | async; as agences){
              <div class="col-md-3 mb-3">
                <label for="agenceId" class="form-label">Agence</label>
                <select
                  name="agenceId"
                  id="agenceId"
                  class="form-select {{ agenceClass }}"
                  [formControl]="agenceCtrl"
                >
                  <option value=""></option>
                  @for(agence of agences; track agence.id){
                  <option [value]="agence.id">
                    {{ agence.nom | uppercase }}
                  </option>
                  }
                </select>
                <div class="invalid-feedback">L'agence est requis!</div>
              </div>
              } @if(membres$ | async; as membres) {
              <div class="col-md-6 mb-3">
                <label for="membreId" class="form-label">Membre</label>
                <select
                  name="membreId"
                  id="membreId"
                  class="form-select {{ membreClass }}"
                  formControlName="membreId"
                >
                  <option value=""></option>
                  @for(membre of membres; track membre.id){
                  <option [value]="membre.id">
                    {{ membre.nom | uppercase }}
                  </option>
                  }
                </select>
                <div class="invalid-feedback">Le membre est requis!</div>
              </div>
              }

              <div class="col-md-3 mb-3">
                <label for="montantCapital" class="form-label">Montant</label>
                <input
                  type="number"
                  name="montantCapital"
                  id="montantCapital"
                  class="form-control {{ montantCapitalClass }}"
                  formControlName="montantCapital"
                />
                <div class="invalid-feedback">Le montant est invalide!</div>
              </div>
              <div class="col-md-3 mb-3">
                <label for="duree" class="form-label">Durée</label>
                <input
                  type="number"
                  name="duree"
                  id="duree"
                  class="form-control {{ dureeClass }}"
                  formControlName="duree"
                />
                <div class="invalid-feedback">La durée est invalide!</div>
              </div>
              <div class="col-md-3 mb-3">
                <label for="dateDemande" class="form-label"
                  >Date de la demande</label
                >
                <input
                  type="date"
                  name="dateDemande"
                  id="dateDemande"
                  class="form-control {{ dateDemandeClass }}"
                  formControlName="dateDemande"
                />
                <div class="invalid-feedback">La date est requise!</div>
              </div>
              <div class="col-md-3 mb-3">
                <label for="dateDecaissement" class="form-label"
                  >Date décaissement</label
                >
                <input
                  type="date"
                  name="dateDecaissement"
                  id="dateDecaissement"
                  class="form-control {{ dateDecaissementClass }}"
                  formControlName="dateDecaissement"
                />
                <div class="invalid-feedback">La date est requise!</div>
              </div>
              <div class="col-md-3 mb-3">
                <label for="differe" class="form-label">Différer de</label>
                <input
                  type="number"
                  name="differe"
                  id="differe"
                  class="form-control {{ differeClass }}"
                  [formControl]="differeCtrl"
                />
                <div class="invalid-feedback">
                  Le différé doit être <= 11 mois!
                </div>
              </div>
            </div>
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col echeancier">
            <app-echeancier-pret
              [echeancier]="echeancier"
              [nbrEcheances]="dureeCtrl.value"
              [echeancierCredit]="false"
            ></app-echeancier-pret>
          </div>
        </div>
      </div>
    </div>

    <hr />
    <div class="d-flex justify-content-end gap-1">
      <button
        class="btn btn-primary"
        type="submit"
        [disabled]="!request.valid || echeancier.length === 0"
      >
        <i class="fa-solid fa-floppy-disk"></i> Enregistrer
      </button>
      <button class="btn btn-danger" type="button" (click)="onCancel()">
        <i class="fa-solid fa-xmark"></i> Annuler
      </button>
    </div>
  </form>
</div>
