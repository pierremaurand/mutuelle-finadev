{"version":3,"file":"ngx-signalr-websocket.mjs","sources":["../../../projects/ngx-signalr-websocket/src/lib/serialization/json-propery-parser.ts","../../../projects/ngx-signalr-websocket/src/lib/serialization/text-message-serializer.ts","../../../projects/ngx-signalr-websocket/src/lib/http-post-client.ts","../../../projects/ngx-signalr-websocket/src/lib/protocol.ts","../../../projects/ngx-signalr-websocket/src/lib/negotiate.ts","../../../projects/ngx-signalr-websocket/src/lib/signalr-connection.ts","../../../projects/ngx-signalr-websocket/src/lib/signalr-client.ts","../../../projects/ngx-signalr-websocket/src/public-api.ts","../../../projects/ngx-signalr-websocket/src/ngx-signalr-websocket.ts"],"sourcesContent":["export declare type JsonProperyParser = (name: string, value: any) => any;\n\nconst isoDateFormat = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d*)?Z$/;\n\nexport const parseIsoDateStrToDate = (_: string, value: string | Date) => {\n  if (typeof value === 'string' && isoDateFormat.test(value)) {\n    return new Date(value);\n  }\n  return value;\n};\n","import { JsonProperyParser } from './json-propery-parser';\nimport { IMessageSerializer } from './message-serializer';\n\nconst recordSeparator = String.fromCharCode(0x1e);\n\nconst pipeParsers = (...converters: JsonProperyParser[]) =>\n  converters.reduce((a, b) => (name: string, value: any) => b(name, a(name, value)));\n\nexport class TextMessageSerializer<T> implements IMessageSerializer<T> {\n  private reviver?: JsonProperyParser;\n\n  constructor(propertyParsers?: JsonProperyParser[]) {\n    if (propertyParsers && propertyParsers.length > 0) {\n      this.reviver = pipeParsers(...propertyParsers);\n    }\n  }\n\n  serialize(messages: T[]): string {\n    return messages.map(message => JSON.stringify(message)).join(recordSeparator) + recordSeparator;\n  }\n\n  deserialize({ data }: MessageEvent): T[] {\n    const message = data as string;\n    const lastIndex = message.length - recordSeparator.length;\n\n    if (message[lastIndex] !== recordSeparator) {\n      throw new Error('Message is incomplete.');\n    }\n\n    const jsonItems = message.substring(0, lastIndex).split(recordSeparator);\n\n    return jsonItems.map(x => JSON.parse(x, this.reviver) as T);\n  }\n}\n","\nimport { Observable } from 'rxjs';\nimport { fromFetch } from 'rxjs/fetch';\n\nexport interface IHttpPostClient {\n  /**\n     * Constructs a `POST` request that interprets the body as JSON\n     * and returns an observable of the response.\n     *\n     * @param url The endpoint URL.\n     * @param body The content to replace with.\n     * @param options HTTP options\n     *\n     * @return  An `Observable` of the `HttpResponse` for the request, with a response body in the\n     * requested type.\n     */\n  post<T>(url: string, body: any | null): Observable<T>;\n}\n\nexport class DefaultHttpPostClient implements IHttpPostClient {\n  post<T>(url: string, body: any): Observable<T> {\n    return fromFetch(url, {\n      method: 'POST', body, selector: response => {\n        if (!response.ok) {\n          throw new Error(response.statusText);\n        }\n\n        return response.json();\n      }\n    });\n  }\n}\n\n\n","export interface IHandshakeRequest {\n  protocol: string;\n  version: number;\n}\n\nexport interface IHandshakeResponse {\n  error: string;\n}\n\nexport enum MessageType {\n\n  /** Indicates the message is an Invocation message and implements the {@link InvocationMessage} interface. */\n  invocation = 1,\n\n  /** Indicates the message is a StreamItem message and implements the {@link StreamItemMessage} interface. */\n  streamItem = 2,\n\n  /** Indicates the message is a Completion message and implements the {@link CompletionMessage} interface. */\n  completion = 3,\n\n  /** Indicates the message is a Stream Invocation message and implements the {@link StreamInvocationMessage} interface. */\n  streamInvocation = 4,\n\n  /** Indicates the message is a Cancel Invocation message and implements the {@link CancelInvocationMessage} interface. */\n  cancelInvocation = 5,\n\n  /** Indicates the message is a Ping message and implements the {@link PingMessage} interface. */\n  ping = 6,\n\n  /** Indicates the message is a Close message and implements the {@link CloseMessage} interface. */\n  close = 7\n}\n\n/** Defines a dictionary of string keys and string values representing headers attached to a Hub message. */\nexport interface IMessageHeaders {\n\n  /** Gets or sets the header with the specified key. */\n  [key: string]: string;\n}\n\n/** Union type of all known Hub messages. */\nexport declare type IHubMessage = IInvocationMessage\n  | IStreamInvocationMessage\n  | IStreamItemMessage\n  | ICompletionMessage\n  | ICancelInvocationMessage\n  | IPingMessage\n  | ICloseMessage;\n\n/** Defines properties common to all Hub messages. */\nexport interface IHubMessageBase {\n\n  /** A {@link MessageType} value indicating the type of this message. */\n  readonly type: MessageType;\n}\n\n/** Defines properties common to all Hub messages relating to a specific invocation. */\nexport interface IHubInvocationMessage extends IHubMessageBase {\n\n  /** A {@link MessageHeaders} dictionary containing headers attached to the message. */\n  readonly headers?: IMessageHeaders;\n\n  /** The ID of the invocation relating to this message.\n   *\n   * This is expected to be present for {@link StreamInvocationMessage}\n   * and {@link CompletionMessage}. It may be 'undefined'\n   * for an {@link InvocationMessage} if the sender does not expect a response.\n   */\n  readonly invocationId?: string;\n}\n\n/** A hub message representing a non-streaming invocation. */\nexport interface IInvocationMessage extends IHubInvocationMessage {\n\n  /** @inheritDoc */\n  readonly type: MessageType.invocation;\n\n  /** The target method name. */\n  readonly target: string;\n\n  /** The target method arguments. */\n  readonly arguments: any[];\n}\n\n/** A hub message representing a streaming invocation. */\nexport interface IStreamInvocationMessage extends IHubInvocationMessage {\n\n  /** @inheritDoc */\n  readonly type: MessageType.streamInvocation;\n\n  /** The invocation ID. */\n  readonly invocationId: string;\n\n  /** The target method name. */\n  readonly target: string;\n\n  /** The target method arguments. */\n  readonly arguments: any[];\n}\n\n/** A hub message representing a single item produced as part of a result stream. */\nexport interface IStreamItemMessage extends IHubInvocationMessage {\n\n  /** @inheritDoc */\n  readonly type: MessageType.streamItem;\n\n  /** The invocation ID. */\n  readonly invocationId: string;\n\n  /** The item produced by the server. */\n  readonly item?: any;\n}\n\n/** A hub message representing the result of an invocation. */\nexport interface ICompletionMessage extends IHubInvocationMessage {\n\n  /** @inheritDoc */\n  readonly type: MessageType.completion;\n\n  /** The invocation ID. */\n  readonly invocationId: string;\n\n  /** The error produced by the invocation, if any.\n   *\n   * Either {@link CompletionMessage.error}\n   * or {@link CompletionMessage.result} must be defined, but not both.\n   */\n  readonly error?: string;\n\n  /** The result produced by the invocation, if any.\n   *\n   * Either {@link CompletionMessage.error}\n   * or {@link CompletionMessage.result} must be defined, but not both.\n   */\n  readonly result?: any;\n}\n\n/** A hub message indicating that the sender is still active. */\nexport interface IPingMessage extends IHubMessageBase {\n\n  /** @inheritDoc */\n  readonly type: MessageType.ping;\n}\n\n/** A hub message indicating that the sender is closing the connection.\n *\n * If {@link CloseMessage.error} is defined, the sender is closing the connection due to an error.\n */\nexport interface ICloseMessage extends IHubMessageBase {\n\n  /** @inheritDoc */\n  readonly type: MessageType.close;\n\n  /** The error that triggered the close, if any.\n   *\n   * If this property is undefined, the connection was closed normally and without error.\n   */\n  readonly error?: string;\n}\n\n/** A hub message sent to request that a streaming invocation be canceled. */\nexport interface ICancelInvocationMessage extends IHubInvocationMessage {\n\n  /** @inheritDoc */\n  readonly type: MessageType.cancelInvocation;\n\n  /** The invocation ID. */\n  readonly invocationId: string;\n}\n\nexport const handshakeRequest: IHandshakeRequest = { protocol: 'json', version: 1 };\nexport const pingMessage: IPingMessage = { type: MessageType.ping };\nexport const closeMessage: ICloseMessage = { type: MessageType.close };\n\nexport const createInvocationMessage = (target: string, args: unknown[], invocationId?: string, headers?: IMessageHeaders): IInvocationMessage => ({\n  type: MessageType.invocation,\n  headers,\n  invocationId,\n  target,\n  arguments: args\n});\n\nexport const createStreamInvocationMessage = (target: string, args: unknown[], invocationId: string, headers?: IMessageHeaders): IStreamInvocationMessage => ({\n  type: MessageType.streamInvocation,\n  headers,\n  invocationId,\n  target,\n  arguments: args,\n});\n\nexport const createCancelInvocationMessage = (invocationId: string, headers?: IMessageHeaders): ICancelInvocationMessage => ({\n  type: MessageType.cancelInvocation,\n  headers,\n  invocationId\n});\n","export enum Transport {\n  longPolling = 'LongPolling',\n  serverSentEvents = 'ServerSentEvents',\n  webSockets = 'WebSockets',\n}\n\nexport enum TransferFormat {\n  binary = 'Binary',\n  text = 'Text',\n}\n\ninterface IAvailableTransport {\n  transport: Transport;\n  transferFormats: string[];\n}\n\nexport interface INegotiateResponse {\n  connectionId: string;\n  availableTransports: IAvailableTransport[];\n}\n","import { debounceTime, filter, first, map, merge, mergeAll, Observable, of, Subject, Subscription, switchMap, take, takeWhile, tap } from 'rxjs';\nimport { webSocket, WebSocketSubject } from 'rxjs/webSocket';\n\nimport {\n  closeMessage,\n  createCancelInvocationMessage,\n  createInvocationMessage,\n  createStreamInvocationMessage,\n  handshakeRequest,\n  ICompletionMessage,\n  IHandshakeRequest,\n  IHubInvocationMessage,\n  IHubMessage,\n  IInvocationMessage,\n  IMessageHeaders,\n  IPingMessage,\n  IStreamItemMessage,\n  MessageType,\n  pingMessage\n} from './protocol';\nimport { IMessageSerializer } from './serialization';\n\nexport enum SignalrConnectionState {\n  closed,\n  opened,\n  closing\n}\n\n/**\n * Represents a connection to a SignalR Hub.\n */\nexport class SignalrConnection {\n\n  timeout = 30_000;\n\n  get opened() { return !this.$maintenance.closed; };\n\n  get state() {\n    return merge(\n      this.open$.pipe(map(() => SignalrConnectionState.opened)),\n      this.close$.pipe(map(() => SignalrConnectionState.closed)),\n      this.closing$.pipe(map(() => SignalrConnectionState.closing))\n    );\n  }\n\n  private subject: WebSocketSubject<(IHubMessage | IHandshakeRequest)[]>;\n  private lastInvocationId = 0;\n\n  private readonly open$ = new Subject<Event>();\n  private readonly close$ = new Subject<Event>();\n  private readonly closing$ = new Subject<void>();\n  private $maintenance: Subscription;\n  private $timeout: Subscription;\n\n  /**\n   * Creates new SignalR hub connection.\n   *\n   * @param url Connection URL.\n   * @param serializer Messages serializer.\n   */\n  constructor(\n    url: string,\n    private readonly serializer: IMessageSerializer<IHubMessage | IHandshakeRequest>,\n    private readonly headersFactory?: (method: string, args: unknown[]) => Observable<IMessageHeaders>) {\n\n    this.subject = webSocket<(IHubMessage | IHandshakeRequest)[]>({\n      url,\n      serializer: value => this.serializer.serialize(value),\n      deserializer: event => this.serializer.deserialize(event),\n      openObserver: this.open$,\n      closeObserver: this.close$,\n      closingObserver: this.closing$\n    });\n\n    this.$maintenance = (this.subject as WebSocketSubject<IPingMessage[]>)\n      .multiplex(\n        () => [handshakeRequest],\n        () => [closeMessage],\n        (messages: IPingMessage[]) => messages.some(({ type }) => type === MessageType.ping))\n      .subscribe(_ => this.subject.next([pingMessage]));\n\n    this.$timeout = this.subject.pipe(debounceTime(this.timeout)).subscribe(() => this.close());\n  }\n\n  /**\n  * Invokes a streaming hub method on the server using the specified name and arguments.\n  * The Observable returned by this method resolves when the server indicates it has finished invoking the stream.\n  *\n  * @param method The name of the server method to invoke.\n  * @param args The arguments used to invoke the server method.\n  * @returns An Observable that yields results from the server as they are received.\n  */\n  stream<TItem>(method: string, ...args: unknown[]): Observable<TItem> {\n    this.checkOpened();\n\n    const invocationId = this.nextInvocationId();\n\n    const stream = this.getHeaders(method, args)\n      .pipe(switchMap(headers =>\n        (this.subject as WebSocketSubject<IHubInvocationMessage[]>).multiplex(\n          () => [createStreamInvocationMessage(method, args, invocationId, headers)],\n          () => [createCancelInvocationMessage(invocationId, headers)],\n          messages => !!messages.find(x => x.invocationId === invocationId)\n        ) as Observable<IHubInvocationMessage[]>));\n\n    return stream.pipe(\n      mergeAll(),\n      filter(x => x.invocationId === invocationId),\n      tap(message => {\n        if (message.type === MessageType.completion) {\n          const { error } = message as ICompletionMessage;\n          if (error) { throw Error(error); }\n        }\n      }),\n      takeWhile(message => message.type !== MessageType.completion),\n      map(message => (message as IStreamItemMessage).item as TItem)\n    );\n  }\n\n  /**\n   * Invokes a hub method on the server using the specified name and arguments.\n   * The Observable returned by this method resolves when the server indicates it has finished invoking the method.\n   *\n   * @param method The name of the server method to invoke.\n   * @param args The arguments used to invoke the server method.\n   * @returns An Observable with single result from the server.\n   */\n  invoke<TItem>(method: string, ...args: unknown[]): Observable<TItem> {\n    this.checkOpened();\n\n    const invocationId = this.nextInvocationId();\n\n    this.getHeaders(method, args)\n      .pipe(map(headers => createInvocationMessage(method, args, invocationId, headers)))\n      .subscribe(invocation => this.subject.next([invocation]));\n\n    return (this.subject as WebSocketSubject<ICompletionMessage[]>)\n      .pipe(\n        mergeAll(1),\n        first(x => x.invocationId === invocationId),\n        map(message => {\n          const { error, result } = message as ICompletionMessage;\n          if (error) { throw Error(error); }\n          return result as TItem;\n        }));\n  }\n\n  /**\n   * Subscribes to invocations with the specified method name.\n   *\n   * @param method The name of the hub method to define.\n   * @returns Invocation's arguments Observable.\n   */\n  on<TArguments extends Array<unknown>>(method: string): Observable<TArguments> {\n    this.checkOpened();\n\n    return (this.subject as WebSocketSubject<IInvocationMessage[]>)\n      .pipe(\n        mergeAll(),\n        filter(({ target }) => target === method),\n        map(message => message.arguments as TArguments));\n  }\n\n  /**\n   * Invokes a hub method on the server using the specified name and arguments.\n   * Does not wait for a response from the receiver.\n   *\n   * @param method The name of the server method to invoke.\n   * @param args The arguments used to invoke the server method.\n   */\n  send(method: string, ...args: unknown[]): void {\n    this.checkOpened();\n\n    this.getHeaders(method, args)\n      .pipe(map(headers => createInvocationMessage(method, args, undefined, headers)))\n      .subscribe(invocation => this.subject.next([invocation]));\n  }\n\n  /**\n   * Closes the connection to hub and terminates subscriptions.\n   */\n  close(): void {\n    this.$timeout?.unsubscribe();\n    this.$maintenance?.unsubscribe();\n    this.subject.complete();\n  }\n\n  private checkOpened() {\n    if (!this.opened) {\n      throw Error(\"Connection not opened\");\n    }\n  }\n\n  private nextInvocationId(): string {\n    this.lastInvocationId++;\n    return this.lastInvocationId.toString();\n  }\n\n  private getHeaders = (method: string, args: unknown[]): Observable<IMessageHeaders | undefined> =>\n    this.headersFactory ? this.headersFactory(method, args).pipe(take(1)) : of(undefined);\n}\n","import { map, Observable } from 'rxjs';\n\nimport { IHttpPostClient } from './http-post-client';\nimport { INegotiateResponse, TransferFormat, Transport } from './negotiate';\nimport { IHandshakeRequest, IHubMessage } from './protocol';\nimport { IMessageSerializer, TextMessageSerializer } from './serialization';\nimport { ISignalrClientOptions } from './signalr-client-options';\nimport { SignalrConnection } from './signalr-connection';\n\nconst defaultOptions: ISignalrClientOptions = {\n  propertyParsers: []\n};\n\n/**\n * SignalR client allows to connect to the hubs.\n */\nexport class SignalrClient {\n  private options: ISignalrClientOptions;\n  private serializer: IMessageSerializer<IHubMessage | IHandshakeRequest>;\n\n  /**\n   * Creates new SignalR client.\n   *\n   * @param httpClient HTTP client performs HTTP requests.\n   * @param options Optional: SignalR client options.\n   */\n  constructor(private readonly httpClient: IHttpPostClient, options?: ISignalrClientOptions) {\n    this.options = { ...defaultOptions, ...options };\n\n    this.serializer = new TextMessageSerializer<IHubMessage | IHandshakeRequest>(this.options.propertyParsers);\n  }\n\n  /**\n   * Creates new SignalR client.\n   *\n   * @param httpClient HTTP client performs HTTP requests.\n   * @param configure Optional: provide action to configure SignalR client options.\n   */\n  static create(httpClient: IHttpPostClient, configure?: (options: ISignalrClientOptions) => void) {\n    let options = defaultOptions;\n\n    if (configure) { configure(options); }\n\n    return new SignalrClient(httpClient, options);\n  }\n\n  /**\n   * Connects to SignalR hub.\n   *\n   * @param hubUrl SignalR hub endpoint URL.\n   * @param accessToken Optional: access token used for client authorization.\n   * @returns SignalR hub connection.\n   */\n  connect(hubUrl: string, accessToken?: string): Observable<SignalrConnection> {\n    return this.negotiate(hubUrl, accessToken)\n      .pipe(map(connectionId => this.createConnection(hubUrl, connectionId, accessToken)));\n  }\n\n  private negotiate(endpointBase: string, accessToken?: string): Observable<string> {\n    const url = new URL(`${endpointBase.replace(/\\/$/, '')}/negotiate`, window.location.href);\n\n    if (accessToken) {\n      url.searchParams.append('access_token', accessToken);\n    }\n\n    return this.httpClient.post<INegotiateResponse>(url.href, null)\n      .pipe(\n        map(response => {\n          if (!response.availableTransports\n            .find(x => x.transport === Transport.webSockets && x.transferFormats.includes(TransferFormat.text))) {\n            throw Error('SignalrClient supports only text WebSocket transport.');\n          }\n\n          return response.connectionId;\n        })\n      );\n  }\n\n  private createConnection(endpointBase: string, connectionId: string, accessToken?: string): SignalrConnection {\n    const url = new URL(endpointBase, window.location.href);\n\n    url.protocol = url.protocol.replace(/^http/, 'ws');\n\n    url.searchParams.append('id', connectionId);\n    if (accessToken) {\n      url.searchParams.append('access_token', accessToken);\n    }\n\n    return new SignalrConnection(url.href, this.serializer, this.options.headersFactory);\n  }\n}\n\n","/*\n * Public API Surface of ngx-signalr-websocket\n */\n\nexport * from './lib/serialization';\nexport * from './lib';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}